<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Android 事件分发 - KALAQIAE</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="Kalaqiae"><meta name=description content="概要 先上图，注意看左下角方法所属
当一个点击事件（MotionEvent ）产生后，系统需把这个事件传递给一个具体的 View 去处理
一次完整的 MotionEvent 事件：ACTION_DOWN(1次) -&amp;gt; ACTION_MOVE(N次) -&amp;gt; ACTION_UP(1次)
"><meta name=keywords content="Hugo,theme,even"><meta name=generator content="Hugo 0.108.0 with theme even"><link rel=canonical href=https://kalaqiae.com/post/android/android-touch/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<link href=/sass/main.min.64cde2c5850b06d3c56f0c74b725d4bdf393df50c9a92b98ffd59a4d5eefab93.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="Android 事件分发"><meta property="og:description" content="概要
先上图，注意看左下角方法所属

当一个点击事件（MotionEvent ）产生后，系统需把这个事件传递给一个具体的 View 去处理
一次完整的 MotionEvent 事件：ACTION_DOWN(1次) -> ACTION_MOVE(N次) -> ACTION_UP(1次)"><meta property="og:type" content="article"><meta property="og:url" content="https://kalaqiae.com/post/android/android-touch/"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-05-06T21:36:48+08:00"><meta property="article:modified_time" content="2021-05-06T21:36:48+08:00"><meta itemprop=name content="Android 事件分发"><meta itemprop=description content="概要
先上图，注意看左下角方法所属

当一个点击事件（MotionEvent ）产生后，系统需把这个事件传递给一个具体的 View 去处理
一次完整的 MotionEvent 事件：ACTION_DOWN(1次) -> ACTION_MOVE(N次) -> ACTION_UP(1次)"><meta itemprop=datePublished content="2021-05-06T21:36:48+08:00"><meta itemprop=dateModified content="2021-05-06T21:36:48+08:00"><meta itemprop=wordCount content="1369"><meta itemprop=keywords content="Android,事件分发,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Android 事件分发"><meta name=twitter:description content="概要
先上图，注意看左下角方法所属

当一个点击事件（MotionEvent ）产生后，系统需把这个事件传递给一个具体的 View 去处理
一次完整的 MotionEvent 事件：ACTION_DOWN(1次) -> ACTION_MOVE(N次) -> ACTION_UP(1次)"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--><script data-ad-client=ca-pub-6216241935841265 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Kalaqiae</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>首页</li></a><a href=/post/><li class=mobile-menu-item>归档</li></a><a href=/tags/><li class=mobile-menu-item>标签</li></a><a href=/categories/><li class=mobile-menu-item>分类</li></a><a href=/about/><li class=mobile-menu-item>关于</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Kalaqiae</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>首页</a></li><li class=menu-item><a class=menu-item-link href=/post/>归档</a></li><li class=menu-item><a class=menu-item-link href=/tags/>标签</a></li><li class=menu-item><a class=menu-item-link href=/categories/>分类</a></li><li class=menu-item><a class=menu-item-link href=/about/>关于</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Android 事件分发</h1><div class=post-meta><span class=post-time>2021-05-06</span><div class=post-category><a href=/categories/android/>Android</a></div><span id=busuanzi_container_page_pv class=more-meta><span id=busuanzi_value_page_pv><img src=/img/spinner.svg alt=spinner.svg></span> 次阅读</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#概要>概要</a></li><li><a href=#事件分发顺序>事件分发顺序</a></li><li><a href=#三个核心方法>三个核心方法</a></li><li><a href=#action_move-和-action_up>ACTION_MOVE 和 ACTION_UP</a></li><li><a href=#其他>其他</a></li></ul></li></ul></li></ul></nav></div></div><div class=post-content><h3 id=概要>概要</h3><p>先上图，注意看左下角方法所属</p><p><img src=https://cdn.jsdelivr.net/gh/kalaqiae/picBank/img/touch.png alt=touch></p><p>当一个点击事件（MotionEvent ）产生后，系统需把这个事件传递给一个具体的 View 去处理</p><p>一次完整的 MotionEvent 事件：ACTION_DOWN(1次) -> ACTION_MOVE(N次) -> ACTION_UP(1次)</p><h3 id=事件分发顺序>事件分发顺序</h3><p>Activity -> Window -> DecorView -> ViewGroup -> View<br>如果事件没有被消费，则会按照相反的顺序回传
View -> ViewGroup -> DecorView -> Window -> Activity</p><p>从系统层级描述事件分发的完整流程包含 Window， DecorView， 如果是从应用层开发来说可以简化省略掉</p><p>Window 是 Android 视图系统的顶层容器，每个 Activity 都关联一个 Window 对象，通常是 PhoneWindow（Window 的唯一实现类）<br>DecorView 是 Window 的根视图，它是一个 FrameLayout ，包含了系统的装饰部分（如状态栏、导航栏）和用户自定义的内容视图</p><h4 id=流程>流程</h4><ul><li>Activity 接收到触摸事件，调用 dispatchTouchEvent() 将事件传递给 ViewGroup</li><li>ViewGroup dispatchTouchEvent() 被调用<ul><li>调用 onInterceptTouchEvent() 来判断是否要拦截</li><li>返回 true：表示拦截，交由自身的 onTouchEvent() 处理</li><li>返回 false：事件传递给子 View</li></ul></li><li>View 的 dispatchTouchEvent() 被调用<ul><li>设置了 OnTouchListener，则先调用 OnTouchListener.onTouch()</li><li>如果 OnTouchListener 没有消费事件，则调用 onTouchEvent()</li></ul></li><li>如果事件未被消费，事件会回传到父 ViewGroup，最终回传到 Activity 的 OnTouchEvent</li></ul><h4 id=总结>总结</h4><ul><li>如果没有重写或者更改默认值。按 Activity > ViewGroup > View 顺序调用 dispatchTouchEvent 方法一层层往下分发</li><li>ViewGroup 通过 onInterceptTouchEvent() 决定是否拦截事件</li><li>进入最底层的View后，开始由最底层的 OnTouchEvent 或 OnTouchListener.onTouch() 来处理，如果一直不消费按 View > ViewGroup > Activity 顺序从下往上调用 onTouchEvent ，最后返回到Activity.OnTouchEvent</li></ul><h3 id=三个核心方法>三个核心方法</h3><p>dispatchTouchEvent 和 onTouchEvent 的 return true,表示事件被消费，就停止传递了（到达终点）</p><p>dispatchTouchEvent 和 onTouchEvent return false 的时候事件都回传给父控件的 onTouchEvent 处理</p><p>onInterceptTouchEvent return true 表示拦截事件，不再传递给子视图，转而调用自身的 onTouchEvent；false 表示不拦截，继续传递给子视图</p><p>ViewGroup 的 dispatchTouchEvent 返回 true 则事件被消费，返回 false 则回传给父控件的 onTouchEvent，<strong>只能通过 Interceptor 把事件拦截下来给自己的 onTouchEvent ，所以 ViewGroup dispatchTouchEvent 方法的 super 默认实现就是去调用 onInterceptTouchEvent。</strong> onInterceptTouchEvent 默认不拦截</p><table><thead><tr><th style=text-align:left>方法</th><th style=text-align:left>作用</th><th style=text-align:left>调用时刻</th></tr></thead><tbody><tr><td style=text-align:left>dispatchTouchEvent()</td><td style=text-align:left>分发（传递）点击事件</td><td style=text-align:left>当点击事件能够传递给当前 View 时</td></tr><tr><td style=text-align:left>onInterceptTouchEvent()</td><td style=text-align:left>事件拦截，<strong>只有 ViewGroup 有</strong></td><td style=text-align:left>在 ViewGroup 的 dispatchTouchEvent() 内部调用</td></tr><tr><td style=text-align:left>onTouchEvent()</td><td style=text-align:left>处理点击事件</td><td style=text-align:left>在 dispatchTouchEvent() 内部调用</td></tr></tbody></table><h3 id=action_move-和-action_up>ACTION_MOVE 和 ACTION_UP</h3><p>在 onTouchEvent 消费事件时：在哪个 View onTouchEvent 返回 true，ACTION_MOVE 和 ACTION_UP 的事件从上往下传到这个 View 后就不再往下传递了，直接传给那个 View 的 onTouchEvent 并结束本次事件传递过程。（包括拦截也是走到 onTouchEvent ）</p><p>在 dispatchTouchEvent 消费事件时：和 ACTION_DOWN 一样</p><h3 id=其他>其他</h3><ul><li><p>如果设置了 OnTouchListener, onTouch() 优先于 onTouchEvent 执行,若手动复写在 onTouch() 中返回 true（即 将事件消费掉），将不会再执行 onTouchEvent()</p></li><li><p>onTouch（）的执行 先于 onClick（）</p></li><li><p>事件不一定会经过Activity<br>程序界面的顶层viewGroup，也就是decorView中注册了Activity这个callBack，所以当程序的主界面接收到事件之后会先交给Activity。<br>但是，如果是另外的控件树，如dialog、popupWindow等事件流是不会经过Activity的。只有自己界面的事件才会经Activity</p></li><li><p>多指<br>ACTION_POINTER_DOWN: 当已经有一个手指按下的情况下，另一个手指按下会产生该事件<br>ACTION_POINTER_UP: 多个手指同时按下的情况下，抬起其中一个手指会产生该事件。<br>多点触摸，每一个触摸点 Pointer 会有一个 id 和 index。对于多指操作，通过 pointerindex 来获取指定 Pointer 的触屏位置。比如，对于单点操作时获取x坐标通过 getX()，而多点操作获取 x 坐标通过 getX(pointerindex)<br>View 默认不支持处理多指，可以先调用 onTouchListener ，再调用 onClickListener 和 onLongClickListener</p></li></ul></div><footer class=post-footer><nav class=post-nav><a class=prev href=/post/android/android-glide/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">Glide 源码 4.12.0</span>
<span class="prev-text nav-mobile">上一篇</span></a>
<a class=next href=/post/common/tools/><span class="next-text nav-default">Tools</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><script src=https://utteranc.es/client.js repo=kalaqiae/kalaqiae.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript></div></main><footer id=footer class=footer><div class=social-links></div><div class=copyright><span class=power-by></span><span class=theme-info></span><div class=busuanzi-footer></div><span class=copyright-year>&copy;
2025
<span>|</span>
<span>Kalaqiae</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js></script>
<script type=text/javascript src=https://cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js></script>
<script src=https://eqcn.ajz.miesnfu.com/wp-content/plugins/wp-3d-pony/live2dw/lib/L2Dwidget.min.js></script>
<script>var jsonModel=["https://unpkg.com/live2d-widget-model-shizuku@1.0.5/assets/shizuku.model.json","https://unpkg.com/live2d-widget-model-hijiki@1.0.5/assets/hijiki.model.json"];L2Dwidget.init({model:{jsonPath:jsonModel[Math.floor(Math.random()*jsonModel.length)],scale:1},display:{position:"left",width:66,height:90,hOffset:10,vOffset:0},mobile:{show:!1}})</script></body></html>