{{ define "title" }}æ—¶é—´æˆ³è½¬æ¢å·¥å…· - {{ .Site.Title }}{{ end }}

{{ define "main" }}
<div class="tool-container">
    <div class="card-content">
        <h1 class="text-3xl font-bold mb-6 text-gray-800 flex items-center">
            <svg class="w-6 h-6 mr-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            æ—¶é—´æˆ³è½¬æ¢å·¥å…·
        </h1>

        <!-- é”™è¯¯å’Œæ¶ˆæ¯æç¤ºåŒº -->
        <div id="messageBox" class="message-box"></div>

        <!-- å®æ—¶æ—¶é—´éƒ¨åˆ† -->
        <div class="mb-8 p-4 rounded-xl border-2 border-indigo-300 bg-indigo-50 shadow-inner">
            <p class="text-base font-bold text-indigo-800 mb-1">å½“å‰ç³»ç»Ÿæ—¶é—´ (æœ¬åœ°æ—¶åŒº):</p>
            <!-- æ˜¾ç¤ºåŒ…å«æ¯«ç§’çš„ç²¾ç¡®æ—¶é—´ -->
            <div class="text-3xl font-mono text-indigo-900 break-words" id="currentTimeDisplay"></div>
            <p class="text-sm text-indigo-600 mt-3">
                å½“å‰ç§’çº§æ—¶é—´æˆ³: <span id="currentTimestampSecond" class="font-mono font-extrabold text-xl mr-4"></span>
                <button onclick="copyTimestamp('second')"
                    class="tool-button-small bg-indigo-500 text-white hover:bg-indigo-600">
                    ğŸ“‹ å¤åˆ¶
                </button>
            </p>
        </div>


        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

            <!-- å·¦ä¾§ï¼šæ—¥æœŸè½¬æ—¶é—´æˆ³ (åŒºåŸŸå¼ºåŒ–) -->
            <div class="conversion-panel bg-white border border-green-200 shadow-lg">
                <h2 class="panel-title bg-green-50 text-green-800">æ—¥æœŸ/æ—¶é—´ â†’ Unix æ—¶é—´æˆ³</h2>
                <div class="panel-body">
                    <!-- è§£å†³ç²¾åº¦é—®é¢˜ï¼Œä½¿ç”¨æ–‡æœ¬è¾“å…¥æ¡† -->
                    <label for="dateTimeInput" class="block text-sm font-medium mb-1 text-gray-700">è¾“å…¥æ—¥æœŸæ—¶é—´ (æ ¼å¼:
                        YYYY-MM-DD HH:MM:SS.ms):</label>
                    <input type="text" id="dateTimeInput" placeholder="ä¾‹å¦‚: 2025-10-24 15:30:45.123"
                        class="input-field mb-3" />

                    <div class="flex space-x-2 mb-4">
                        <button onclick="getCurrentTime()"
                            class="tool-button-small flex-1 bg-green-600 text-white hover:bg-green-700">
                            ğŸ“… å¡«å……å½“å‰å®Œæ•´æ—¶é—´
                        </button>
                    </div>

                    <p class="text-gray-700 mb-2 mt-4 font-medium">é€‰æ‹©è½¬æ¢ç²¾åº¦:</p>
                    <div class="flex space-x-4 mb-4">
                        <label class="flex items-center">
                            <input type="radio" name="precision" value="second" checked
                                class="form-radio text-blue-600">
                            <span class="ml-2 text-gray-700">ç§’çº§ (10ä½)</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="precision" value="millisecond" class="form-radio text-blue-600">
                            <span class="ml-2 text-gray-700">æ¯«ç§’çº§ (13ä½)</span>
                        </label>
                    </div>

                    <button onclick="convertToTimestamp()"
                        class="tool-button bg-blue-600 text-white hover:bg-blue-700 w-full mb-4">
                        ğŸš€ è½¬æ¢ä¸ºæ—¶é—´æˆ³
                    </button>

                    <label for="timestampOutput" class="block text-sm font-medium mb-1 text-gray-500">æ—¶é—´æˆ³ç»“æœ:</label>
                    <input type="text" id="timestampOutput" readonly placeholder="åœ¨æ­¤æ˜¾ç¤ºæ—¶é—´æˆ³..."
                        class="input-field font-mono" />
                    <button onclick="copyTimestamp('output')"
                        class="tool-button-small bg-gray-200 text-gray-800 hover:bg-gray-300 w-full mt-2">
                        ğŸ“‹ å¤åˆ¶ç»“æœ
                    </button>
                </div>
            </div>

            <!-- å³ä¾§ï¼šæ—¶é—´æˆ³è½¬æ—¥æœŸ (åŒºåŸŸå¼ºåŒ–) -->
            <div class="conversion-panel bg-white border border-red-200 shadow-lg">
                <h2 class="panel-title bg-red-50 text-red-800">Unix æ—¶é—´æˆ³ â†’ æ—¥æœŸ/æ—¶é—´</h2>
                <div class="panel-body">
                    <label for="timestampInput" class="block text-sm font-medium mb-1 text-gray-700">è¾“å…¥ 10 ä½æˆ– 13
                        ä½æ—¶é—´æˆ³:</label>
                    <input type="text" id="timestampInput" placeholder="ä¾‹å¦‚: 1678886400000"
                        class="input-field mb-4 font-mono" />

                    <button onclick="convertToDateTime()"
                        class="tool-button bg-gray-500 text-white hover:bg-gray-600 w-full mb-4">
                        ğŸ” è½¬æ¢ä¸ºæ—¥æœŸ/æ—¶é—´
                    </button>

                    <label for="dateTimeOutput" class="block text-sm font-medium mb-1 text-gray-500">æ—¥æœŸ/æ—¶é—´ç»“æœ
                        (æœ¬åœ°æ—¶åŒºï¼Œç²¾ç¡®åˆ°æ¯«ç§’):</label>
                    <input type="text" id="dateTimeOutput" readonly placeholder="åœ¨æ­¤æ˜¾ç¤ºæ—¥æœŸæ—¶é—´..." class="input-field" />
                </div>
            </div>
        </div>

        <!-- æ¸…ç©ºæŒ‰é’® -->
        <div class="flex justify-center mt-8">
            <button onclick="clearAll()" class="tool-button bg-gray-200 text-gray-800 hover:bg-gray-300">
                ğŸ§¹ æ¸…ç©ºæ‰€æœ‰åŒºåŸŸ
            </button>
        </div>
    </div>
</div>

<style>
    .tool-container {
        max-width: 1000px;
        margin: 40px auto;
        padding: 20px;
    }

    .card-content {
        background-color: var(--card-background-base);
        padding: 1.5rem;
        border-radius: var(--border-radius);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(5px);
        border: 1px solid #E0E0E0;
    }

    .input-field {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #E0E0E0;
        border-radius: 0.5rem;
        font-size: 1rem;
        outline: none;
        transition: border-color 0.2s;
        background-color: #F8F9FA;
    }

    .input-field:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.2);
    }

    /* æŒ‰é’®æ ·å¼ */
    .tool-button,
    .tool-button-small {
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 600;
        transition: all 0.2s;
        border: none;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    .tool-button-small {
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
    }

    .tool-button:hover,
    .tool-button-small:hover {
        box-shadow: 0 4px 8px rgba(30, 136, 229, 0.4);
        transform: translateY(-1px);
    }

    /* æ¶ˆæ¯æç¤ºæ¡† */
    .message-box {
        padding: 1rem;
        border-radius: var(--border-radius);
        margin-bottom: 1rem;
        font-weight: 500;
        display: none;
    }

    .message-box.error {
        background-color: #FEE2E2;
        color: #EF4444;
        border: 1px solid #FCA5A5;
    }

    .message-box.info {
        background-color: #E3F2FD;
        color: #1E88E5;
        border: 1px solid #90CAF9;
    }

    /* åŒºåŸŸä¼˜åŒ–æ ·å¼ */
    .conversion-panel {
        padding: 0;
        border-radius: var(--border-radius);
        overflow: hidden;
    }

    .panel-title {
        font-size: 1.5rem;
        font-weight: 700;
        padding: 1rem 1.5rem;
        margin-bottom: 0;
        text-align: center;
    }

    /* æ–°å¢ï¼šä¸ºåŒºåŸŸå†…éƒ¨å†…å®¹æä¾›ç»Ÿä¸€çš„å†…è¾¹è·ï¼Œè§£å†³è´´è¾¹é—®é¢˜ */
    .panel-body {
        padding: 1.5rem;
        padding-top: 1rem;
        /* ç¨å¾®å‡å°‘é¡¶éƒ¨ä¸æ ‡é¢˜çš„è·ç¦» */
    }

    .conversion-panel .input-field {
        margin-bottom: 1rem;
    }
</style>

<script>
    const dateTimeInput = document.getElementById('dateTimeInput');
    const timestampInput = document.getElementById('timestampInput');
    const timestampOutput = document.getElementById('timestampOutput');
    const dateTimeOutput = document.getElementById('dateTimeOutput');
    const currentTimeDisplay = document.getElementById('currentTimeDisplay');
    const currentTimestampSecond = document.getElementById('currentTimestampSecond');
    const messageBox = document.getElementById('messageBox');

    // Utility function to display messages
    function showMessage(message, type = 'info') {
        messageBox.textContent = message;
        messageBox.className = 'message-box';
        messageBox.classList.add(type);
        messageBox.style.display = 'block';

        setTimeout(() => {
            messageBox.style.display = 'none';
        }, 5000);
    }

    // --- å®æ—¶æ—¶é—´æ›´æ–° ---
    function getTimezoneString() {
        const offset = new Date().getTimezoneOffset(); // returns minutes
        const sign = offset > 0 ? '-' : '+';
        const absOffset = Math.abs(offset);
        const hours = String(Math.floor(absOffset / 60)).padStart(2, '0');
        const minutes = String(absOffset % 60).padStart(2, '0');
        return `(UTC${sign}${hours}:${minutes})`;
    }

    // æ ¼å¼åŒ–æœ¬åœ°æ—¶é—´ä¸º YYYY-MM-DD HH:MM:SS.ms æ ¼å¼
    function formatLocalTime(date) {
        const Y = date.getFullYear();
        const M = String(date.getMonth() + 1).padStart(2, '0');
        const D = String(date.getDate()).padStart(2, '0');
        const h = String(date.getHours()).padStart(2, '0');
        const m = String(date.getMinutes()).padStart(2, '0');
        const s = String(date.getSeconds()).padStart(2, '0');
        const ms = String(date.getMilliseconds()).padStart(3, '0');
        return `${Y}-${M}-${D} ${h}:${m}:${s}.${ms}`;
    }

    function updateCurrentTime() {
        const now = new Date();

        // æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´ï¼ŒåŒ…å«æ¯«ç§’
        currentTimeDisplay.textContent = formatLocalTime(now) + ' ' + getTimezoneString();

        // æ˜¾ç¤ºç§’çº§æ—¶é—´æˆ³
        currentTimestampSecond.textContent = Math.floor(now.getTime() / 1000);
    }

    // æ¯ 100ms æ›´æ–°ä¸€æ¬¡å®æ—¶æ—¶é—´
    setInterval(updateCurrentTime, 100);
    updateCurrentTime(); // ç«‹å³æ‰§è¡Œä¸€æ¬¡

    // --- æ—¥æœŸè½¬æ—¶é—´æˆ³ ---

    // æ ¸å¿ƒä¿®å¤ï¼šæ‰‹åŠ¨è§£æ 'YYYY-MM-DD HH:MM:SS.ms' å­—ç¬¦ä¸²ï¼Œä»¥ç¡®ä¿æœ¬åœ°æ—¶é—´å’Œæ¯«ç§’ç²¾åº¦
    function parseLocalTime(str) {
        // åŒ¹é…ç»„ä»¶: YYYY-MM-DD HH:MM:SS.msï¼Œæ¯«ç§’å¯é€‰
        const match = str.match(/(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})\.?(\d{0,3})?/);
        if (!match) return null;

        // è§£æ„åŒ¹é…åˆ°çš„æ•°å­—ï¼ˆéœ€è¦è½¬æ¢ä¸ºæ•°å­—ç±»å‹ï¼‰
        // match[1] = YYYY, match[2] = MM, ..., match[7] = ms
        const components = match.slice(1, 7).map(Number);
        const millisecond = match[7] ? Number(match[7].padEnd(3, '0')) : 0; // ç¡®ä¿æ¯«ç§’æ˜¯ 3 ä½

        // ä½¿ç”¨æœ¬åœ°æ—¶é—´æ„é€ å‡½æ•° (æœˆä»½æ˜¯ 0-basedï¼Œæ‰€ä»¥éœ€è¦å‡ 1)
        // new Date(year, monthIndex, day, hour, minute, second, millisecond)
        return new Date(
            components[0], components[1] - 1, components[2],
            components[3], components[4], components[5], millisecond
        );
    }

    function convertToTimestamp() {
        messageBox.style.display = 'none';
        const input = dateTimeInput.value.trim();

        if (!input) {
            showMessage("è¾“å…¥å†…å®¹ä¸èƒ½ä¸ºç©ºï¼Œè¯·ä½¿ç”¨ YYYY-MM-DD HH:MM:SS.ms æ ¼å¼ã€‚", 'error');
            timestampOutput.value = "";
            return;
        }

        try {
            const date = parseLocalTime(input);

            if (!date || isNaN(date.getTime())) {
                showMessage("æ—¥æœŸæ ¼å¼æ— æ•ˆï¼Œè¯·æ£€æŸ¥æ ¼å¼æ˜¯å¦ä¸º YYYY-MM-DD HH:MM:SS.ms", 'error');
                timestampOutput.value = "";
                return;
            }

            const precision = document.querySelector('input[name="precision"]:checked').value;
            let timestamp;

            if (precision === 'second') {
                // è½¬æ¢ä¸ºç§’çº§ (10ä½)
                timestamp = Math.floor(date.getTime() / 1000);
            } else {
                // è½¬æ¢ä¸ºæ¯«ç§’çº§ (13ä½)
                timestamp = date.getTime();
            }

            timestampOutput.value = timestamp.toString();
            showMessage(`è½¬æ¢æˆåŠŸï¼å·²è¾“å‡º${precision === 'second' ? 'ç§’çº§' : 'æ¯«ç§’çº§'}æ—¶é—´æˆ³ã€‚`);

        } catch (e) {
            showMessage("è½¬æ¢è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ã€‚", 'error');
            console.error("Conversion Error:", e);
        }
    }

    // --- æ—¶é—´æˆ³è½¬æ—¥æœŸ ---
    function convertToDateTime() {
        messageBox.style.display = 'none';
        let input = timestampInput.value.trim();

        if (!input) {
            showMessage("è¯·å…ˆè¾“å…¥æ—¶é—´æˆ³ã€‚", 'error');
            dateTimeOutput.value = "";
            return;
        }

        // ç§»é™¤æ‰€æœ‰éæ•°å­—å­—ç¬¦
        input = input.replace(/\D/g, '');

        if (input.length !== 10 && input.length !== 13) {
            showMessage("æ—¶é—´æˆ³é•¿åº¦å¿…é¡»æ˜¯ 10 ä½ (ç§’) æˆ– 13 ä½ (æ¯«ç§’)ã€‚", 'error');
            dateTimeOutput.value = "";
            return;
        }

        let timestamp = parseInt(input, 10);
        let date;

        if (input.length === 10) {
            // 10ä½ç§’çº§æ—¶é—´æˆ³ï¼Œä¹˜ä»¥ 1000 è½¬æ¢ä¸ºæ¯«ç§’
            date = new Date(timestamp * 1000);
            showMessage("æŒ‰ç§’çº§ (10ä½) æ—¶é—´æˆ³è¿›è¡Œè½¬æ¢ã€‚");
        } else {
            // 13ä½æ¯«ç§’çº§æ—¶é—´æˆ³
            date = new Date(timestamp);
            showMessage("æŒ‰æ¯«ç§’çº§ (13ä½) æ—¶é—´æˆ³è¿›è¡Œè½¬æ¢ã€‚");
        }

        if (isNaN(date.getTime())) {
            showMessage("æ—¶é—´æˆ³æ— æ•ˆï¼Œæ— æ³•è½¬æ¢ä¸ºæœ‰æ•ˆæ—¥æœŸã€‚", 'error');
            dateTimeOutput.value = "";
            return;
        }

        // æ ¼å¼åŒ–è¾“å‡º (æœ¬åœ°æ—¶åŒºï¼Œç²¾ç¡®åˆ°æ¯«ç§’)
        dateTimeOutput.value = formatLocalTime(date);
    }

    // --- è¾…åŠ©åŠŸèƒ½ ---

    // å¡«å……å½“å‰å®Œæ•´æ—¶é—´åˆ°è¾“å…¥æ¡†
    function getCurrentTime() {
        const now = new Date();
        dateTimeInput.value = formatLocalTime(now);
        showMessage("å·²å°†å½“å‰å®Œæ•´æ—¶é—´ (åŒ…å«æ¯«ç§’) å¡«å……åˆ°è¾“å…¥æ¡†ã€‚", 'info');
    }

    // å¤åˆ¶æ—¶é—´æˆ³
    function copyTimestamp(type) {
        let copyText;
        if (type === 'second') {
            copyText = currentTimestampSecond.textContent;
        } else { // 'output'
            copyText = timestampOutput.value;
        }

        if (!copyText) {
            showMessage("æ—¶é—´æˆ³ä¸ºç©ºï¼Œæ— æ³•å¤åˆ¶ã€‚", 'error');
            return;
        }

        // ä½¿ç”¨ document.execCommand('copy') å…¼å®¹æ€§æ›´å¥½ (iframe ç¯å¢ƒ)
        const tempInput = document.createElement('input');
        tempInput.value = copyText;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand('copy');
        document.body.removeChild(tempInput);

        showMessage("æ—¶é—´æˆ³å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼", 'info');
    }

    // æ¸…ç©ºæ‰€æœ‰
    function clearAll() {
        dateTimeInput.value = "";
        timestampInput.value = "";
        timestampOutput.value = "";
        dateTimeOutput.value = "";
        messageBox.style.display = 'none';
        showMessage("å·²æ¸…ç©ºæ‰€æœ‰åŒºåŸŸã€‚", 'info');
    }
</script>
{{ end }}