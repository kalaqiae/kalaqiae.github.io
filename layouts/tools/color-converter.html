{{ define "title" }}é¢œè‰²è½¬æ¢å·¥å…· - {{ .Site.Title }}{{ end }}

{{ define "main" }}
<div class="tool-container">
    <div class="card-content">
        <h1 class="text-3xl font-bold mb-6 text-gray-800 flex items-center">
            <svg class="w-6 h-6 mr-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01">
                </path>
            </svg>
            é¢œè‰²è½¬æ¢å·¥å…· (HEX / RGB / HSL)
        </h1>

        <!-- é”™è¯¯å’Œæ¶ˆæ¯æç¤ºåŒº -->
        <div id="messageBox" class="message-box"></div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">

            <!-- å·¦ä¾§ï¼šé¢œè‰²é¢„è§ˆ -->
            <div class="md:col-span-1 flex flex-col items-center">
                <label class="block text-lg font-semibold mb-2 text-gray-700">é¢œè‰²é¢„è§ˆ</label>
                <div id="colorPreview"
                    class="w-full aspect-square rounded-xl shadow-inner border-4 border-gray-200 bg-white mb-4 transition-colors duration-200"
                    style="background-color: #3B82F6;"></div>
                <input type="color" id="colorPicker" value="#3B82F6"
                    class="w-full h-12 cursor-pointer border-0 p-0 bg-transparent">
                <p class="text-sm text-gray-500 mt-2 text-center">ç‚¹å‡»è‰²å—æˆ–ä¸‹æ–¹æ¡å½¢é€‰æ‹©é¢œè‰²</p>
            </div>

            <!-- å³ä¾§ï¼šè½¬æ¢è¾“å…¥åŒº -->
            <div class="md:col-span-2 space-y-6">

                <!-- HEX Input -->
                <div class="input-group relative">
                    <label for="hexInput" class="block text-sm font-medium text-gray-700 mb-1">HEX</label>
                    <div class="flex">
                        <span
                            class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 font-mono">#</span>
                        <input type="text" id="hexInput" value="3B82F6"
                            class="flex-1 min-w-0 block w-full px-3 py-2 rounded-none rounded-r-md border border-gray-300 focus:ring-blue-500 focus:border-blue-500 font-mono uppercase"
                            placeholder="RRGGBB">
                        <button onclick="copyValue('hexInput', '#')"
                            class="ml-2 tool-button-small bg-gray-100 hover:bg-gray-200 text-gray-600 border border-gray-300">ğŸ“‹</button>
                    </div>
                </div>

                <!-- RGB Input -->
                <div class="input-group">
                    <label class="block text-sm font-medium text-gray-700 mb-1">RGB (Red, Green, Blue)</label>
                    <div class="grid grid-cols-3 gap-2">
                        <input type="number" id="rInput" min="0" max="255" value="59"
                            class="color-num-input border-red-200 focus:border-red-500 focus:ring-red-500"
                            placeholder="R">
                        <input type="number" id="gInput" min="0" max="255" value="130"
                            class="color-num-input border-green-200 focus:border-green-500 focus:ring-green-500"
                            placeholder="G">
                        <input type="number" id="bInput" min="0" max="255" value="246"
                            class="color-num-input border-blue-200 focus:border-blue-500 focus:ring-blue-500"
                            placeholder="B">
                    </div>
                    <div class="flex mt-2">
                        <input type="text" id="rgbString" readonly
                            class="flex-1 px-3 py-1 bg-gray-50 border border-gray-200 rounded-md text-sm text-gray-500 font-mono"
                            value="rgb(59, 130, 246)">
                        <button onclick="copyValue('rgbString')"
                            class="ml-2 tool-button-small bg-gray-100 hover:bg-gray-200 text-gray-600 border border-gray-300">ğŸ“‹</button>
                    </div>
                </div>

                <!-- HSL Input -->
                <div class="input-group">
                    <label class="block text-sm font-medium text-gray-700 mb-1">HSL (Hue, Saturation, Lightness)</label>
                    <div class="grid grid-cols-3 gap-2">
                        <div class="relative">
                            <input type="number" id="hInput" min="0" max="360" value="217" class="color-num-input pr-6"
                                placeholder="H">
                            <span class="absolute right-3 top-2 text-gray-400">Â°</span>
                        </div>
                        <div class="relative">
                            <input type="number" id="sInput" min="0" max="100" value="91" class="color-num-input pr-6"
                                placeholder="S">
                            <span class="absolute right-3 top-2 text-gray-400">%</span>
                        </div>
                        <div class="relative">
                            <input type="number" id="lInput" min="0" max="100" value="60" class="color-num-input pr-6"
                                placeholder="L">
                            <span class="absolute right-3 top-2 text-gray-400">%</span>
                        </div>
                    </div>
                    <div class="flex mt-2">
                        <input type="text" id="hslString" readonly
                            class="flex-1 px-3 py-1 bg-gray-50 border border-gray-200 rounded-md text-sm text-gray-500 font-mono"
                            value="hsl(217, 91%, 60%)">
                        <button onclick="copyValue('hslString')"
                            class="ml-2 tool-button-small bg-gray-100 hover:bg-gray-200 text-gray-600 border border-gray-300">ğŸ“‹</button>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<style>
    .tool-container {
        max-width: 1000px;
        margin: 40px auto;
        padding: 20px;
    }

    .card-content {
        background-color: var(--card-background-base);
        padding: 2rem;
        border-radius: var(--border-radius);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(5px);
        border: 1px solid #E0E0E0;
    }

    /* è¾“å…¥æ¡†é€šç”¨æ ·å¼ */
    .color-num-input {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #D1D5DB;
        border-radius: 0.375rem;
        text-align: center;
        font-family: monospace;
        font-size: 1rem;
        outline: none;
        transition: all 0.2s;
    }

    .color-num-input:focus {
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
    }

    input[type="text"] {
        outline: none;
    }

    .tool-button-small {
        padding: 0.5rem 0.75rem;
        border-radius: 0.375rem;
        cursor: pointer;
        transition: all 0.2s;
    }

    /* æ¶ˆæ¯æç¤ºæ¡† */
    .message-box {
        padding: 1rem;
        border-radius: var(--border-radius);
        margin-bottom: 1.5rem;
        font-weight: 500;
        display: none;
    }

    .message-box.info {
        background-color: #E3F2FD;
        color: #1E88E5;
        border: 1px solid #90CAF9;
    }

    .message-box.error {
        background-color: #FEE2E2;
        color: #EF4444;
        border: 1px solid #FCA5A5;
    }
</style>

<script>
    // DOM Elements
    const colorPreview = document.getElementById('colorPreview');
    const colorPicker = document.getElementById('colorPicker');

    const hexInput = document.getElementById('hexInput');

    const rInput = document.getElementById('rInput');
    const gInput = document.getElementById('gInput');
    const bInput = document.getElementById('bInput');
    const rgbString = document.getElementById('rgbString');

    const hInput = document.getElementById('hInput');
    const sInput = document.getElementById('sInput');
    const lInput = document.getElementById('lInput');
    const hslString = document.getElementById('hslString');

    const messageBox = document.getElementById('messageBox');

    // --- Utility Functions ---

    function showMessage(message, type = 'info') {
        messageBox.textContent = message;
        messageBox.className = 'message-box';
        messageBox.classList.add(type);
        messageBox.style.display = 'block';
        setTimeout(() => messageBox.style.display = 'none', 3000);
    }

    function copyValue(elementId, prefix = '') {
        const input = document.getElementById(elementId);
        let text = input.value;
        if (prefix && !text.startsWith(prefix)) {
            text = prefix + text;
        }

        const tempInput = document.createElement('input');
        tempInput.value = text;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand('copy');
        document.body.removeChild(tempInput);

        showMessage(`å·²å¤åˆ¶: ${text}`, 'info');
    }

    function updatePreview(hex) {
        colorPreview.style.backgroundColor = hex;
        colorPicker.value = hex;
    }

    // --- Core Conversion Logic ---

    // HEX to RGB
    function hexToRgb(hex) {
        // Expand shorthand form (e.g. "03F") to full form (e.g. "0033FF")
        const shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
        hex = hex.replace(shorthandRegex, (m, r, g, b) => r + r + g + g + b + b);

        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result ? {
            r: parseInt(result[1], 16),
            g: parseInt(result[2], 16),
            b: parseInt(result[3], 16)
        } : null;
    }

    // RGB to HEX
    function rgbToHex(r, g, b) {
        return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
    }

    // RGB to HSL
    function rgbToHsl(r, g, b) {
        r /= 255, g /= 255, b /= 255;
        const max = Math.max(r, g, b), min = Math.min(r, g, b);
        let h, s, l = (max + min) / 2;

        if (max === min) {
            h = s = 0; // achromatic
        } else {
            const d = max - min;
            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
            switch (max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }
            h /= 6;
        }

        return {
            h: Math.round(h * 360),
            s: Math.round(s * 100),
            l: Math.round(l * 100)
        };
    }

    // HSL to RGB
    function hslToRgb(h, s, l) {
        h /= 360;
        s /= 100;
        l /= 100;
        let r, g, b;

        if (s === 0) {
            r = g = b = l; // achromatic
        } else {
            const hue2rgb = (p, q, t) => {
                if (t < 0) t += 1;
                if (t > 1) t -= 1;
                if (t < 1 / 6) return p + (q - p) * 6 * t;
                if (t < 1 / 2) return q;
                if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
                return p;
            };
            const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
            const p = 2 * l - q;
            r = hue2rgb(p, q, h + 1 / 3);
            g = hue2rgb(p, q, h);
            b = hue2rgb(p, q, h - 1 / 3);
        }

        return {
            r: Math.round(r * 255),
            g: Math.round(g * 255),
            b: Math.round(b * 255)
        };
    }

    // --- Event Handlers ---

    function updateFromHex() {
        let hex = hexInput.value.replace('#', '');
        if (hex.length === 3) { // Support short hex
            hex = hex.split('').map(c => c + c).join('');
        }

        if (hex.length !== 6 || !/^[0-9A-Fa-f]{6}$/.test(hex)) return; // Valid HEX only

        const rgb = hexToRgb(hex);
        if (!rgb) return;

        const hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);

        // Update RGB Inputs
        rInput.value = rgb.r;
        gInput.value = rgb.g;
        bInput.value = rgb.b;
        rgbString.value = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;

        // Update HSL Inputs
        hInput.value = hsl.h;
        sInput.value = hsl.s;
        lInput.value = hsl.l;
        hslString.value = `hsl(${hsl.h}, ${hsl.s}%, ${hsl.l}%)`;

        updatePreview("#" + hex);
    }

    function updateFromRgb() {
        let r = parseInt(rInput.value) || 0;
        let g = parseInt(gInput.value) || 0;
        let b = parseInt(bInput.value) || 0;

        // Clamp
        r = Math.max(0, Math.min(255, r));
        g = Math.max(0, Math.min(255, g));
        b = Math.max(0, Math.min(255, b));

        const hex = rgbToHex(r, g, b);
        const hsl = rgbToHsl(r, g, b);

        // Update Hex
        hexInput.value = hex.replace('#', '');

        // Update HSL
        hInput.value = hsl.h;
        sInput.value = hsl.s;
        lInput.value = hsl.l;

        // Update Strings
        rgbString.value = `rgb(${r}, ${g}, ${b})`;
        hslString.value = `hsl(${hsl.h}, ${hsl.s}%, ${hsl.l}%)`;

        updatePreview(hex);
    }

    function updateFromHsl() {
        let h = parseInt(hInput.value) || 0;
        let s = parseInt(sInput.value) || 0;
        let l = parseInt(lInput.value) || 0;

        // Clamp
        h = Math.max(0, Math.min(360, h));
        s = Math.max(0, Math.min(100, s));
        l = Math.max(0, Math.min(100, l));

        const rgb = hslToRgb(h, s, l);
        const hex = rgbToHex(rgb.r, rgb.g, rgb.b);

        // Update Hex
        hexInput.value = hex.replace('#', '');

        // Update RGB
        rInput.value = rgb.r;
        gInput.value = rgb.g;
        bInput.value = rgb.b;

        // Update Strings
        rgbString.value = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
        hslString.value = `hsl(${h}, ${s}%, ${l}%)`;

        updatePreview(hex);
    }

    function updateFromPicker() {
        const hex = colorPicker.value;
        hexInput.value = hex.replace('#', ''); // Set HEX without #
        updateFromHex(); // Trigger updates based on new HEX
    }

    // --- Listeners ---

    hexInput.addEventListener('input', updateFromHex);

    [rInput, gInput, bInput].forEach(el => el.addEventListener('input', updateFromRgb));

    [hInput, sInput, lInput].forEach(el => el.addEventListener('input', updateFromHsl));

    colorPicker.addEventListener('input', updateFromPicker);

    // Init
    updateFromHex(); // Initialize based on default HEX value

</script>
{{ end }}