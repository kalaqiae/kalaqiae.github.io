{{ define "title" }}Base64 åŠ è§£å¯†å·¥å…· - {{ .Site.Title }}{{ end }}

{{ define "main" }}
<div class="tool-container">
    <div class="card-content">
        <h1 class="text-3xl font-bold mb-6 text-gray-800 flex items-center">
            <svg class="w-6 h-6 mr-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.879a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1">
                </path>
            </svg>
            Base64 åŠ è§£å¯†å·¥å…·
        </h1>

        <!-- é”™è¯¯å’Œæ¶ˆæ¯æç¤ºåŒº -->
        <div id="messageBox" class="message-box"></div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- å·¦ä¾§ï¼šè¾“å…¥åŒº -->
            <div>
                <label for="inputArea" class="block text-lg font-semibold mb-2 text-gray-700">è¾“å…¥æ–‡æœ¬æˆ– Base64 å­—ç¬¦ä¸²:</label>
                <textarea id="inputArea" placeholder="åœ¨æ­¤è¾“å…¥éœ€è¦å¤„ç†çš„æ–‡æœ¬..."></textarea>
            </div>

            <!-- å³ä¾§ï¼šè¾“å‡ºåŒº -->
            <div>
                <label for="outputArea" class="block text-lg font-semibold mb-2 text-gray-700">è¾“å‡ºç»“æœ:</label>
                <textarea id="outputArea" placeholder="å¤„ç†ç»“æœå°†æ˜¾ç¤ºåœ¨æ­¤..."></textarea>
            </div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="flex flex-wrap justify-center md:justify-start space-x-4 mt-6">
            <button onclick="handleBase64(true)" class="tool-button bg-blue-600 text-white hover:bg-blue-700">
                ğŸš€ ç¼–ç  (Encode)
            </button>
            <button onclick="handleBase64(false)" class="tool-button bg-gray-500 text-white hover:bg-gray-600">
                ğŸ” è§£ç  (Decode)
            </button>
            <button onclick="clearAll()" class="tool-button bg-gray-200 text-gray-800 hover:bg-gray-300">
                ğŸ§¹ æ¸…ç©º
            </button>
            <button onclick="copyOutput()" class="tool-button bg-gray-200 text-gray-800 hover:bg-gray-300">
                ğŸ“‹ å¤åˆ¶ç»“æœ
            </button>
        </div>
    </div>
</div>

<style>
    .tool-container {
        max-width: 1000px;
        margin: 40px auto;
        padding: 20px;
    }

    /* æ–‡æœ¬è¾“å…¥æ¡†æ ·å¼ */
    textarea {
        width: 100%;
        height: 200px;
        padding: 1rem;
        border: 2px solid #E0E0E0;
        border-radius: var(--border-radius);
        font-family: monospace;
        font-size: 0.95rem;
        resize: none;
        outline: none;
        transition: border-color 0.2s;
        background-color: #F8F9FA;
    }

    textarea:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.2);
    }

    .card-content {
        background-color: var(--card-background-base);
        padding: 1.5rem;
        border-radius: var(--border-radius);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(5px);
        border: 1px solid #E0E0E0;
    }

    /* æŒ‰é’®åŠ¨ç”» */
    .tool-button {
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 600;
        transition: all 0.2s;
    }

    .tool-button:hover {
        box-shadow: 0 4px 8px rgba(30, 136, 229, 0.4);
        transform: translateY(-1px);
    }

    /* æ¶ˆæ¯æç¤ºæ¡† */
    .message-box {
        padding: 1rem;
        border-radius: var(--border-radius);
        margin-top: 1rem;
        font-weight: 500;
        display: none;
        /* é»˜è®¤éšè— */
    }

    .message-box.error {
        background-color: #FEE2E2;
        color: #EF4444;
        border: 1px solid #FCA5A5;
    }
</style>

<script>
    const inputArea = document.getElementById('inputArea');
    const outputArea = document.getElementById('outputArea');
    const messageBox = document.getElementById('messageBox');

    /**
     * æ˜¾ç¤ºæ¶ˆæ¯æç¤º
     * @param {string} message - æç¤ºå†…å®¹
     * @param {string} type - æ¶ˆæ¯ç±»å‹ ('success', 'error', 'info')
     */
    function showMessage(message, type = 'info') {
        messageBox.textContent = message;
        messageBox.className = 'message-box'; // é‡ç½®ç±»
        messageBox.classList.add(type);
        messageBox.style.display = 'block';

        // 5ç§’åè‡ªåŠ¨éšè—
        setTimeout(() => {
            messageBox.style.display = 'none';
        }, 5000);
    }

    /**
     * Base64 ç¼–ç æ“ä½œ
     * @param {string} text - è¾“å…¥æ–‡æœ¬
     * @returns {string} Base64 ç¼–ç ç»“æœ
     */
    function encodeBase64(text) {
        // å…ˆè¿›è¡Œ URI ç¼–ç ä»¥æ”¯æŒä¸­æ–‡å’Œç‰¹æ®Šå­—ç¬¦ (UTF-8)
        const utf8String = encodeURIComponent(text);
        return btoa(utf8String);
    }

    /**
     * Base64 è§£ç æ“ä½œ
     * @param {string} base64String - Base64 å­—ç¬¦ä¸²
     * @returns {string} è§£ç ç»“æœ
     */
    function decodeBase64(base64String) {
        // ç§»é™¤ Base64 å­—ç¬¦ä¸²æœ«å°¾å¯èƒ½å‡ºç°çš„å¡«å……å­—ç¬¦æˆ–ä¸è§„èŒƒçš„ç©ºç™½
        base64String = base64String.trim();

        // å°è¯•è§£ç 
        const utf8String = atob(base64String);
        // è¿›è¡Œ URI è§£ç ï¼Œæ¢å¤ä¸­æ–‡å’Œç‰¹æ®Šå­—ç¬¦
        return decodeURIComponent(utf8String);
    }

    /**
     * å¤„ç† Base64 æ“ä½œçš„å…¥å£å‡½æ•°
     * @param {boolean} isEncode - true è¡¨ç¤ºç¼–ç ï¼Œfalse è¡¨ç¤ºè§£ç 
     */
    function handleBase64(isEncode) {
        messageBox.style.display = 'none';
        const input = inputArea.value.trim();

        if (!input) {
            showMessage("è¾“å…¥å†…å®¹ä¸èƒ½ä¸ºç©ºï¼", 'error');
            return;
        }

        try {
            if (isEncode) {
                const encoded = encodeBase64(input);
                outputArea.value = encoded;
                showMessage("ç¼–ç æˆåŠŸï¼", 'info');
            } else {
                const decoded = decodeBase64(input);
                outputArea.value = decoded;
                showMessage("è§£ç æˆåŠŸï¼", 'info');
            }
        } catch (e) {
            // æ•è·æ— æ•ˆ Base64 å­—ç¬¦æˆ– URI å¼‚å¸¸
            showMessage("æ“ä½œå¤±è´¥ï¼šè¾“å…¥çš„ Base64 æ ¼å¼æ— æ•ˆæˆ–åŒ…å«é UTF-8 å­—ç¬¦ã€‚", 'error');
            console.error("Base64 Error:", e);
            outputArea.value = "";
        }
    }

    /**
     * æ¸…ç©ºæ‰€æœ‰è¾“å…¥å’Œè¾“å‡º
     */
    function clearAll() {
        inputArea.value = "";
        outputArea.value = "";
        messageBox.style.display = 'none';
        showMessage("å·²æ¸…ç©ºæ‰€æœ‰åŒºåŸŸã€‚", 'info');
    }

    /**
     * å¤åˆ¶è¾“å‡ºç»“æœåˆ°å‰ªè´´æ¿
     */
    function copyOutput() {
        const output = outputArea.value;
        if (!output) {
            showMessage("è¾“å‡ºç»“æœä¸ºç©ºï¼Œæ— æ³•å¤åˆ¶ã€‚", 'error');
            return;
        }

        // ä½¿ç”¨ document.execCommand('copy') å…¼å®¹æ€§æ›´å¥½ (iframe ç¯å¢ƒ)
        outputArea.select();
        document.execCommand('copy');
        outputArea.setSelectionRange(0, 0); // å–æ¶ˆé€‰ä¸­

        showMessage("ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼", 'info');
    }
</script>
{{ end }}