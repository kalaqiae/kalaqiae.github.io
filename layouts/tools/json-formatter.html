{{ define "title" }}JSON æ ¼å¼åŒ–å·¥å…· - {{ .Site.Title }}{{ end }}

{{ define "main" }}
<div class="tool-container">
    <div class="card-content">
        <h1 class="text-3xl font-bold mb-6 text-gray-800 flex items-center">
            <svg class="w-6 h-6 mr-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
            </svg>
            JSON æ ¼å¼åŒ–ä¸éªŒè¯å·¥å…·
        </h1>

        <!-- é”™è¯¯å’Œæ¶ˆæ¯æç¤ºåŒº -->
        <div id="messageBox" class="message-box"></div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- å·¦ä¾§ï¼šè¾“å…¥åŒº -->
            <div>
                <label for="inputArea" class="block text-lg font-semibold mb-2 text-gray-700">è¾“å…¥ JSON/æ–‡æœ¬:</label>
                <textarea id="inputArea" placeholder="åœ¨æ­¤ç²˜è´´ JSON å­—ç¬¦ä¸²æˆ– JavaScript å¯¹è±¡..."></textarea>
            </div>

            <!-- å³ä¾§ï¼šè¾“å‡ºåŒº -->
            <div>
                <label for="outputArea" class="block text-lg font-semibold mb-2 text-gray-700">è¾“å‡ºç»“æœ:</label>
                <textarea id="outputArea" placeholder="å¤„ç†åçš„ JSON å°†æ˜¾ç¤ºåœ¨æ­¤..."></textarea>
            </div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="flex flex-wrap justify-center md:justify-start space-x-4 mt-6 col-span-1 lg:col-span-2">
            <button onclick="formatJson()" class="tool-button bg-green-600 text-white hover:bg-green-700">
                âœ¨ æ ¼å¼åŒ– (Format)
            </button>
            <button onclick="minifyJson()" class="tool-button bg-red-600 text-white hover:bg-red-700">
                ğŸ“¦ å‹ç¼© (Minify)
            </button>
            <button onclick="validateJson()" class="tool-button bg-yellow-500 text-gray-800 hover:bg-yellow-600">
                âœ… éªŒè¯ (Validate)
            </button>
            <button onclick="clearAll()" class="tool-button bg-gray-200 text-gray-800 hover:bg-gray-300">
                ğŸ§¹ æ¸…ç©º
            </button>
            <button onclick="copyOutput()" class="tool-button bg-gray-200 text-gray-800 hover:bg-gray-300">
                ğŸ“‹ å¤åˆ¶ç»“æœ
            </button>
        </div>
    </div>
</div>

<style>
    .tool-container {
        max-width: 1000px;
        margin: 40px auto;
        padding: 20px;
    }

    /* æ–‡æœ¬è¾“å…¥æ¡†æ ·å¼ */
    textarea {
        width: 100%;
        height: 400px;
        /* å¢åŠ é«˜åº¦ä»¥å®¹çº³æ›´å¤š JSON */
        padding: 1rem;
        border: 2px solid #E0E0E0;
        border-radius: var(--border-radius);
        font-family: 'Consolas', 'Courier New', monospace;
        /* é€‚åˆä»£ç çš„å­—ä½“ */
        font-size: 0.95rem;
        resize: vertical;
        /* å…è®¸å‚ç›´æ‹–åŠ¨ */
        outline: none;
        transition: border-color 0.2s;
        background-color: #F8F9FA;
    }

    textarea:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.2);
    }

    .card-content {
        background-color: var(--card-background-base);
        padding: 1.5rem;
        border-radius: var(--border-radius);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(5px);
        border: 1px solid #E0E0E0;
    }

    /* æŒ‰é’®åŠ¨ç”» */
    .tool-button {
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 600;
        transition: all 0.2s;
        border: none;
        cursor: pointer;
    }

    .tool-button:hover {
        box-shadow: 0 4px 8px rgba(30, 136, 229, 0.4);
        transform: translateY(-1px);
    }

    /* æ¶ˆæ¯æç¤ºæ¡† */
    .message-box {
        padding: 1rem;
        border-radius: var(--border-radius);
        margin-bottom: 1rem;
        font-weight: 500;
        display: none;
        /* é»˜è®¤éšè— */
    }

    .message-box.error {
        background-color: #FEE2E2;
        color: #EF4444;
        border: 1px solid #FCA5A5;
    }

    .message-box.success {
        background-color: #D1FAE5;
        color: #059669;
        border: 1px solid #34D399;
    }

    .message-box.info {
        background-color: #E3F2FD;
        color: #1E88E5;
        border: 1px solid #90CAF9;
    }
</style>

<script>
    const inputArea = document.getElementById('inputArea');
    const outputArea = document.getElementById('outputArea');
    const messageBox = document.getElementById('messageBox');

    /**
     * æ˜¾ç¤ºæ¶ˆæ¯æç¤º
     */
    function showMessage(message, type = 'info') {
        messageBox.textContent = message;
        messageBox.className = 'message-box'; // é‡ç½®ç±»
        messageBox.classList.add(type);
        messageBox.style.display = 'block';

        // 5ç§’åè‡ªåŠ¨éšè—
        setTimeout(() => {
            messageBox.style.display = 'none';
        }, 5000);
    }

    /**
     * æ ¸å¿ƒå‡½æ•°ï¼šè§£æè¾“å…¥ JSON æ–‡æœ¬
     * @returns {object|null} è§£æåçš„ JavaScript å¯¹è±¡ï¼Œå¦‚æœå¤±è´¥è¿”å› null
     */
    function parseInput() {
        messageBox.style.display = 'none';
        const input = inputArea.value.trim();

        if (!input) {
            showMessage("è¾“å…¥å†…å®¹ä¸èƒ½ä¸ºç©ºã€‚", 'error');
            return null;
        }

        try {
            // å°è¯•è§£æ JSON
            return JSON.parse(input);
        } catch (e) {
            showMessage(`JSON è§£æå¤±è´¥ï¼š${e.message.substring(0, 100)}...`, 'error');
            outputArea.value = "";
            return null;
        }
    }

    /**
     * æ ¼å¼åŒ– (Beautify) JSON
     */
    function formatJson() {
        const obj = parseInput();
        if (obj === null) return;

        try {
            // ä½¿ç”¨ JSON.stringify çš„ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ç¼©è¿› (2ä¸ªç©ºæ ¼)
            const formatted = JSON.stringify(obj, null, 2);
            outputArea.value = formatted;
            showMessage("JSON æ ¼å¼åŒ–æˆåŠŸï¼", 'success');
        } catch (e) {
            showMessage("æ ¼å¼åŒ–å¤±è´¥ã€‚", 'error');
            outputArea.value = "";
        }
    }

    /**
     * å‹ç¼© (Minify) JSON
     */
    function minifyJson() {
        const obj = parseInput();
        if (obj === null) return;

        try {
            // ä¸ä½¿ç”¨ç¼©è¿› (null, 0 æˆ–ä¸ä¼ å‚)
            const minified = JSON.stringify(obj);
            outputArea.value = minified;
            showMessage("JSON å‹ç¼©æˆåŠŸï¼", 'success');
        } catch (e) {
            showMessage("å‹ç¼©å¤±è´¥ã€‚", 'error');
            outputArea.value = "";
        }
    }

    /**
     * éªŒè¯ (Validate) JSON
     */
    function validateJson() {
        messageBox.style.display = 'none';
        const input = inputArea.value.trim();

        if (!input) {
            showMessage("è¾“å…¥å†…å®¹ä¸èƒ½ä¸ºç©ºã€‚", 'error');
            return;
        }

        try {
            JSON.parse(input);
            showMessage("âœ… JSON è¯­æ³•æœ‰æ•ˆï¼", 'success');
        } catch (e) {
            showMessage(`âŒ JSON éªŒè¯å¤±è´¥ï¼š${e.message}`, 'error');
        }
        outputArea.value = ""; // éªŒè¯é€šå¸¸ä¸éœ€è¦æ”¹å˜è¾“å‡ºæ¡†
    }

    /**
     * æ¸…ç©ºæ‰€æœ‰è¾“å…¥å’Œè¾“å‡º
     */
    function clearAll() {
        inputArea.value = "";
        outputArea.value = "";
        messageBox.style.display = 'none';
        showMessage("å·²æ¸…ç©ºæ‰€æœ‰åŒºåŸŸã€‚", 'info');
    }

    /**
     * å¤åˆ¶è¾“å‡ºç»“æœåˆ°å‰ªè´´æ¿
     */
    function copyOutput() {
        const output = outputArea.value;
        if (!output) {
            showMessage("è¾“å‡ºç»“æœä¸ºç©ºï¼Œæ— æ³•å¤åˆ¶ã€‚", 'error');
            return;
        }

        // ä½¿ç”¨ document.execCommand('copy') å…¼å®¹æ€§æ›´å¥½ (iframe ç¯å¢ƒ)
        outputArea.select();
        document.execCommand('copy');
        outputArea.setSelectionRange(0, 0); // å–æ¶ˆé€‰ä¸­

        showMessage("ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼", 'info');
    }
</script>
{{ end }}